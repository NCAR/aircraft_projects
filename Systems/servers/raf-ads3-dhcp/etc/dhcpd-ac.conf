ddns-updates on;
ddns-update-style interim;
update-static-leases true;
deny duplicates;

# We have purposely blocked dynamic allocation of IPs to unknown laptops.
# This policy gives NCAR's IT department the authority to 'vet' out the systems
# before they are introduced to the aircraft's network.  This 'vetting' process
# typically entails sweeping the systems for viruses and disabling
# automated updates which try to obtain new packages from the internet.
# deny unknown-clients;
allow unknown-clients;

one-lease-per-client on;
ping-check off;

# If client-updates are allowed, then a visiting client can ask for
# a name like  mypc.psu.edu. dhcpd will provide that
# name and will only ask DNS to update the PTR record and
# not the A record, and so DNS will not assign a name in the local
# domain.
ignore client-updates;
# allow client-updates;

# Whether to use the name of the host in the
# host xxx {} declaration for the host-name option.
use-host-decl-names on;

# This is the key used by the rndc program to start/stop/control named
include "/etc/rndc.key";

# This is the key used for updates between dhcpd and named
include "/etc/raf.ucar.edu.key";

# default domain
option domain-name "raf.ucar.edu";

###########################################################################
# Here's the plan for addresses, on both the .84 and .184 networks:
# 0-63: fixed address systems, least restrictive firewall rules (64 addrs)
# 64-159: fixed addresses (DSMs are 100-159), restrictive firewall (96 addrs)
# 160-223: dynamic addresses, restrictive firewall (64 addresses)
# 224-255: reserved (32 addresses)

# Info on the mapping of network/netmask to address range.
# network/netmask    address range
# 192.168.84.0/27    192.168.84.0-31
# 192.168.84.32/27   192.168.84.32-63
# 192.168.84.64/27   192.168.84.64-95
# 192.168.84.96/27   192.168.84.96-127
# 192.168.84.128/27  192.168.84.128-159
# 192.168.84.160/27  192.168.84.160-191
# 192.168.84.192/27  192.168.84.192-223
# 192.168.84.224/27  192.168.84.192-255
 
# 192.168.84.0/26    192.168.84.0-63
# 192.168.84.64/26   192.168.84.64-127
# 192.168.84.128/26  192.168.84.128-191
# 192.168.84.192/26  192.168.84.192-255

# 192.168.84.0/25    192.168.84.0-127
# 192.168.84.128/25  192.168.84.128-255
###########################################################################

subnet 192.168.84.0 netmask 255.255.255.0 {
  authoritative;
  range dynamic-bootp 192.168.84.160 192.168.84.223;
  option routers 192.168.84.1;
  option broadcast-address 192.168.84.255;
  option ntp-servers 192.168.184.10,192.168.84.1;
  option domain-name-servers 192.168.84.1;
  default-lease-time 86400;
  max-lease-time 86400;
  ddns-hostname = concat("dhcp-",binary-to-ascii(10,8,"-",leased-address));
}

subnet 192.168.184.0 netmask 255.255.255.0 {
  authoritative;
  range dynamic-bootp 192.168.184.160 192.168.184.223;
  option routers 192.168.184.1;
  option broadcast-address 192.168.184.255;
  option ntp-servers 192.168.184.10,192.168.184.1;
  option domain-name-servers 192.168.184.1;
  default-lease-time 86400;
  max-lease-time 86400;
  ddns-hostname = concat("dhcp-",binary-to-ascii(10,8,"-",leased-address));
}

subnet 128.117.0.0 netmask 255.255.0.0 {
  not authoritative;
}

zone raf.ucar.edu. {
   primary 127.0.0.1;
   key raf.ucar.edu;
}
zone 84.168.192.in-addr.arpa. {
   primary 127.0.0.1;
   key raf.ucar.edu;
}
zone 184.168.192.in-addr.arpa. {
   primary 127.0.0.1;
   key raf.ucar.edu;
}

# host entries must have different hostnames (the field after "host")
# but can have the same ddns-hostname.
# So if we have two systems that should have the same dns name on
# each aircraft, like "fwdcam", but have different MAC addresses,
# they can both be configured here with different names in the host xxx {}
# declaration, like fwdcam-gv and fwdcam-c130, but the same value for
# ddns-hostname and the same value for option host-name.
# This may reduce the need for different dhcpd configs on each plane.
group {
  # GV timeserver
  host timeserver-gv {
    hardware ethernet 00:0e:fe:00:04:a9;
    ddns-hostname "timeserver";
    option host-name  "timeserver";
    fixed-address 192.168.184.10;
  }

  # C130 fwdcam
  host fwdcam-c130 {
    hardware ethernet 00:40:8c:5c:0f:9d;
    ddns-hostname "fwdcam";
    option host-name "fwdcam";
  }

  # GV Camera DSM labeled DSMC01
  host dsmc01 {
    hardware ethernet 00:e0:5c:3a:02:ef;
    ddns-hostname "dsmc01";
    option host-name  "dsmc01";
    fixed-address 192.168.184.16;
  }

  # hubs
  # GV 84 subnet is a cisco, not netgear, perhaps c130?
  host netgear84-gv {
     hardware ethernet 00:09:5B:5A:F3:15;
     ddns-hostname "netgear84";
     option host-name "netgear84";
  }
  host netgear184-gv {
     hardware ethernet 00:09:5B:5A:F8:75;
     ddns-hostname "netgear184";
     option host-name "netgear184";
  }

  host bonnie {
     hardware ethernet 00:14:22:dc:ba:0d;
     ddns-hostname "bonnie";
  }

  host clyde {
     hardware ethernet 00:14:22:dc:c3:c3;
     ddns-hostname "clyde";
  }
  host gdm-pc {
     hardware ethernet 00:12:3f:f6:73:20;
     ddns-hostname "gdm-pc";
  }
  host hyper1-pc {
     hardware ethernet 00:11:43:6f:69:76;
     ddns-hostname "hyper1-pc";
  }
  host hyper2-pc {
     hardware ethernet 00:11:43:6f:69:ae;
     ddns-hostname "hyper2-pc";
  }
  host hyper3-pc {
     hardware ethernet 00:11:43:6f:69:2f;
     ddns-hostname "hyper3-pc";
  }
  host hyper4-pc {
     hardware ethernet 00:11:43:78:dc:ff;
     ddns-hostname "hyper4-pc";
  }
  host hyper5-pc {
     hardware ethernet 00:14:22:e6:d1:1d;
     ddns-hostname "hyper5-pc";
  }
  host eol-rdma {
     hardware ethernet 00:15:60:b6:0c:93;
     ddns-hostname "eol-rdma";
  }
  host accam {
     hardware ethernet 00:30:1b:bd:94:cb;
     ddns-hostname "accam";
  }
  host dgps-pc {
     hardware ethernet 00:0f:1f:cb:08:e8;
     ddns-hostname "dgps-pc";
  }
  host fo3cl-pc {
     hardware ethernet 00:80:2f:ab:c1:23;
     ddns-hostname "fo3cl-pc";
  }
  host mtp-pc {
     hardware ethernet 00:15:17:58:f0:41;
     ddns-hostname "mtp-pc";
  }
  host nonoy03-pc {
     hardware ethernet 00:80:2f:0a:5b:8c;
     ddns-hostname "nonoy03-pc";
  }
  host avaps-pc {
     hardware ethernet 00:11:11:34:31:dd;
     ddns-hostname "avaps-pc";
  }
  host perseus {
     hardware ethernet 00:0D:56:DF:CA:C3;
     ddns-hostname "perseus";
  }
  # Britt Stephen's AO2 instrument
  host ao2-daq {
     hardware ethernet 00:06:d5:10:98:fe;
     ddns-hostname "ao2-daq";
  }
  # CVI pc
  host cvi-pc {
     hardware ethernet 00:0b:97:d8:9e:0b;
     ddns-hostname "cvi-pc";
     fixed-address 192.168.184.143;
  }
}
