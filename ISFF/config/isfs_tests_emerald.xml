<?xml version="1.0" encoding="ISO-8859-1"?>

<!-- Copyright 2005 UCAR, NCAR, All Rights Reserved -->

<project
    xmlns="http://www.eol.ucar.edu/nidas"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.eol.ucar.edu/nidas nidas.xsd"
    name="isfs_tests"
    system="ISFF"
    version="$LastChangedRevision: 863 $">

    <sensorcatalog>
	<serialSensor ID="CSAT3" class="isff.CSAT3_Sonic"
	    baud="9600" parity="none" databits="8" stopbits="1" timeout="0">
	    <parameter name="soniclog" type="string" value="/var/log/isfs/${DSM}_${PROJECT}_csat3.log"/>
	    <sample id="1">
		<variable name="u" units="m/s"/>
		<variable name="v" units="m/s"/>
		<variable name="w" units="m/s"/>
		<variable name="tc" units="degC"/>
		<variable name="diag" units=""/>
		<variable name="spd" units="m/s"/>
		<variable name="dir" units="deg"/>
		<variable name="uflag" units=""/>
		<variable name="vflag" units=""/>
		<variable name="wflag" units=""/>
		<variable name="tcflag" units=""/>
	    </sample>
	    <message separator="\x55\xaa" position="end" length="10"/>
	</serialSensor>

       <serialSensor ID="NCAR_TRH" class="DSMSerialSensor"
            baud="9600" parity="none" databits="8" stopbits="1">
            <!--  |TRH703 21.67 10.25\n\r| -->
            <sample id="1" scanfFormat="TRH%d%f%f">
                <variable name="ID" units=""/>
                <variable name="T" units="degC"/>
                <variable name="RH" units="%"/>
            </sample>
            <message separator="\r" position="end" length="0"/>
        </serialSensor>

       <serialSensor ID="NCAR_TRH_V" class="DSMSerialSensor"
            baud="9600" parity="none" databits="8" stopbits="1">
            <!--  |TRH703 21.67 10.25 12.0\n\r| -->
            <sample id="1" scanfFormat="TRH%d%f%f%f">
                <variable name="ID" units=""/>
                <variable name="T" units="degC"/>
                <variable name="RH" units="%"/>
                <variable name="Vbatt" units="V"/>
            </sample>
            <message separator="\r" position="end" length="0"/>
        </serialSensor>

       <serialSensor ID="NCAR_SHT" class="DSMSerialSensor"
            baud="9600" parity="none" databits="8" stopbits="1">
	    <!-- TRH004 23.35 26.76 6301 820\r\n -->
            <sample id="1" scanfFormat="TRH%d%f%f%d%d">
                <variable name="ID" units=""/>
                <variable name="T" units="degC"/>
                <variable name="RH" units="%"/>
                <variable name="Traw" units=""/>
                <variable name="RHraw" units=""/>
            </sample>
            <message separator="\n" position="end" length="0"/>
        </serialSensor>

        <serialSensor ID="Vais_PTB" class="DSMSerialSensor"
            baud="9600" parity="none" databits="8" stopbits="1">
            <!-- |B7  832.44  22.7\r\n| -->
            <sample id="1" scanfFormat="%*c%*d%f%f">
                <variable name="P" units="mb"/>
                <variable name="Tbaro" units="degC"/>
            </sample>
            <message separator="\n" position="end" length="0"/>
        </serialSensor>

        <serialSensor ID="Paro_760" class="DSMSerialSensor"
            baud="9600" parity="none" databits="8" stopbits="1">
	    <!-- *0001834.5604\r\n -->
            <sample id="1" scanfFormat="*%*4d%f">
                <variable name="P" units="mb"/>
            </sample>
            <message separator="\n" position="end" length="0"/>
        </serialSensor>

        <serialSensor ID="SOAD" class="DSMSerialSensor"
            baud="9600" parity="none" databits="8" stopbits="1">
            <message separator="\r" position="end" length="0"/>
            <prompt string="#86OD\r" rate="1"/>
        </serialSensor>

        <serialSensor ID="SOAD_NOPROMPT" class="DSMSerialSensor"
            baud="9600" parity="none" databits="8" stopbits="1">
            <message separator="\r" position="end" length="0"/>
        </serialSensor>

       <serialSensor ID="Garmin_GPS" class="GPS_NMEA_Serial"
            baud="4800" parity="none" databits="8" stopbits="1">

            <!-- GGA record -->
            <sample id="1">
                <variable name="GPSsecsofday" units="sec" longname="seconds of day"/>
                <variable name="Lat" units="degree_N" longname="GPS Latitude"/>
                <variable name="Lon" units="degree_E" longname="GPS Longitude"/>
                <variable name="GPSqual" units="none" longname="GPS Qual, 0=inval,1=GPS,2=DGPS"/>
                <variable name="GPSnsat" units="count" longname="Number of GPS satellites tracked"/>
                <variable name="GPShordil" units="none" longname="Horizontal dilution of position"/>
                <variable name="Alt" units="m" longname="GPS Altitude (MSL)"/>
                <variable name="GPSgeoidht" units="m" longname="Height of geoid (MSL) above WGS84 ellipsoid"/>
                <variable name="GPSdage" units="s" longname="time in seconds since last DGPS update"/>
                <variable name="GPSdid" units="none" longname="DGPS station ID number"/>
            </sample>
            <!-- RMC record -->
            <sample id="2">
                <variable name="GPSstat" units="none" longname="GPS rcvr status: 1=OK(A), 0=warning(V)"/>
                <variable name="GPSsog" units="m/s" longname="Speed over ground"/>
                <variable name="GPSgmg" units="degree_T" longname="Course made good"/>
                <variable name="GPSvew" units="m/s" longname="East/West velocity"/>
                <variable name="GPSvns" units="m/s" longname="North/South velocity"/>
                <variable name="GPSday" units="day" longname="Day of month (1-31)"/>
                <variable name="GPSmonth" units="month" longname="Month of year (1-12)"/>
                <variable name="GPSyear" units="year" longname="2 digit year"/>
            </sample>
            <message separator="\n" position="end" length="0"/>
        </serialSensor>

	<!-- LICOR 7500 -->
	<serialSensor ID="LICOR_7500" class="DSMSerialSensor"
	    baud="19200" parity="none" databits="8" stopbits="1">
	    <sample id="1" scanfFormat="%f%f%f%f%f%f">
		<variable name="co2raw" units=""/>
		<variable name="co2" units="mmol/m^3"/>
		<variable name="h2oraw" units=""/>
		<variable name="h2o" units="mmol/m^3">
		    <linear units="g/m^3" slope="18.0e-3" intercept="0.0"/>
		</variable>
		<variable name="Tcell" units="degC"/>
		<variable name="Pcell" units="kPa"/>
	    </sample>
	    <message separator="\n" position="end" length="0"/>
	</serialSensor>

    </sensorcatalog>

    <site name="lab" class="isff.GroundStation">

	<dsm rserialPort="30002" name="tunnel" id="1">

	    <serialSensor IDREF="CSAT3"
		devicename="/dev/ttyS5" id="500" suffix=".5">
	        <sample id="1" rate="60"/>
	    </serialSensor>
	    <serialSensor IDREF="CSAT3"
		devicename="/dev/ttyS6" id="600" suffix=".6">
	        <sample id="1" rate="60"/>
	    </serialSensor>
	    <serialSensor IDREF="CSAT3"
		devicename="/dev/ttyS7" id="700" suffix=".7">
	        <sample id="1" rate="60"/>
	    </serialSensor>
	    <serialSensor IDREF="CSAT3"
		devicename="/dev/ttyS8" id="800" suffix=".8">
	        <sample id="1" rate="60"/>
	    </serialSensor>
	    <serialSensor IDREF="CSAT3"
		devicename="/dev/ttyS9" id="900" suffix=".9">
	        <sample id="1" rate="60"/>
	    </serialSensor>
	    <serialSensor IDREF="CSAT3"
		devicename="/dev/ttyS10" id="1000" suffix=".10">
	        <sample id="1" rate="60"/>
	    </serialSensor>
	    <serialSensor IDREF="CSAT3"
		devicename="/dev/ttyS11" id="1100" suffix=".11">
	        <sample id="1" rate="60"/>
	    </serialSensor>
	    <serialSensor IDREF="CSAT3"
		devicename="/dev/ttyS12" id="1200" suffix=".12">
	        <sample id="1" rate="60"/>
	    </serialSensor>

	    <output class="RawSampleOutputStream" sorterLength="0">
		<!-- socket type="dgrequest" address="base"/ -->
		<socket type="mcrequest"/>
	    </output>
	    <output class="RawSampleOutputStream" sorterLength="0">
                <socket type="server" port="30000"/>
            </output>
	</dsm>

    </site>

    <server>
        <service class="XMLConfigService">
            <output>
                <socket type="mcaccept" maxIdle="60"/>
            </output>
        </service>
	<service class="RawSampleService" priority="RT_RR:50">
            <!-- input from every DSM that has an output of type RawSampleOutputStream -->
            <input class="RawSampleInputStream">
                <socket type="mcaccept"/>
            </input>
	    <processor class="SampleArchiver">
                <output class="SampleOutputStream" sorterLength="0">
                    <socket type="server" port="30000"/>
                </output>
                <output class="SampleOutputStream" sorterLength="0">
                    <socket type="server" path="dsm_data"/>
                </output>
            </processor>

	    <processor class="StatisticsProcessor" id="30000" optional="false">
                <sample period="300">
                    <parameter name="type" type="string" value="mean"/>
                    <parameter name="counts" type="string" value="dcnts_5"/>
                    <parameter name="invars" type="strings"
                        value="diag.5"/>
                </sample>
                <sample period="300">
                    <parameter name="type" type="string" value="mean"/>
                    <parameter name="counts" type="string" value="dcnts_6"/>
                    <parameter name="invars" type="strings"
                        value="diag.6"/>
                </sample>
                <sample period="300">
                    <parameter name="type" type="string" value="mean"/>
                    <parameter name="counts" type="string" value="dcnts_7"/>
                    <parameter name="invars" type="strings"
                        value="diag.7"/>
                </sample>
                <sample period="300">
                    <parameter name="type" type="string" value="mean"/>
                    <parameter name="counts" type="string" value="dcnts_8"/>
                    <parameter name="invars" type="strings"
                        value="diag.8"/>
                </sample>
                <sample period="300">
                    <parameter name="type" type="string" value="mean"/>
                    <parameter name="counts" type="string" value="dcnts_9"/>
                    <parameter name="invars" type="strings"
                        value="diag.9"/>
                </sample>
                <sample period="300">
                    <parameter name="type" type="string" value="mean"/>
                    <parameter name="counts" type="string" value="dcnts_10"/>
                    <parameter name="invars" type="strings"
                        value="diag.10"/>
                </sample>
                <sample period="300">
                    <parameter name="type" type="string" value="mean"/>
                    <parameter name="counts" type="string" value="dcnts_11"/>
                    <parameter name="invars" type="strings"
                        value="diag.11"/>
                </sample>
                <sample period="300">
                    <parameter name="type" type="string" value="mean"/>
                    <parameter name="counts" type="string" value="dcnts_12"/>
                    <parameter name="invars" type="strings"
                        value="diag.12"/>
                </sample>

		<output class="isff.NetcdfRPCOutput">
                    <ncserver
                        server="porter.atd.ucar.edu"
                        dir="/net/isff/projects/$PROJECT/$SYSTEM/$NETCDF_DIR"
                        file="isff_%Y%m%d.nc" length="86400"
                        floatFill="1.e37"
                        timeout="300"
                        batchPeriod="300"/>
                </output>
            </processor>
        </service>
    </server>
</project>
